<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Lista de Contactos - DOM y JavaScript</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
    <style>
        .favorite-star {
            color: gold;
        }
    </style>
</head>
<body>
    <div class="container my-1 my-sm-2 my-md-4 my-lg-5">
        <h1>Lista de Contactos</h1>
        <div class="card">
            <div class="card-body">
                <h2>Contactos</h2>
                <div class="d-flex justify-content-between mb-3">
                    <div class="btn-group" role="group">
                        <button id="ordenar-nombre" class="btn btn-secondary">Ordenar por Nombre</button>
                        <button id="ordenar-apellido" class="btn btn-secondary">Ordenar por Apellido</button>
                    </div>
                    <div class="btn-group" role="group">
                        <button id="mostrar-todos" class="btn btn-success">Ver Todos</button>
                        <button id="mostrar-favoritos" class="btn btn-warning">Ver Favoritos</button>
                        <button id="eliminar-seleccionados" class="btn btn-danger">Eliminar Seleccionados</button>
                    </div>
                </div>
                <div class="input-group mb-3">
                    <input type="text" class="form-control" id="buscador" placeholder="Buscar por nombre, apellido o teléfono">
                </div>
                
                <ul id="lista-contactos" class="list-group"></ul>

                <hr class="hr">

                <h2>Nuevo Contacto</h2>
                <form id="form-contacto">
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" name="nombre" id="input-nombre" placeholder="Nombre" aria-label="Nombre">
                        <input type="text" class="form-control" name="apellido" id="input-apellido" placeholder="Apellido" aria-label="Apellido">
                        <input type="text" class="form-control" name="telefono" id="input-telefono" placeholder="Teléfono" aria-label="Teléfono">
                    </div>
                    <button class="btn btn-primary" type="submit">Agregar Contacto</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', () => {
            let contactos = JSON.parse(localStorage.getItem('contactos')) || [
                { nombre: 'Juan', apellido: 'Perez', telefono: '1122334455', favorito: false },
                { nombre: 'Ana', apellido: 'Gomez', telefono: '2233445566', favorito: true },
                { nombre: 'Carlos', apellido: 'Rodriguez', telefono: '3344556677', favorito: false },
            ];

            const listaContactos = document.getElementById('lista-contactos');
            const formContacto = document.getElementById('form-contacto');
            const inputNombre = document.getElementById('input-nombre');
            const inputApellido = document.getElementById('input-apellido');
            const inputTelefono = document.getElementById('input-telefono');
            const buscador = document.getElementById('buscador');

            function guardarContactos() {
                localStorage.setItem('contactos', JSON.stringify(contactos));
            }

            function mostrarListado(contactosAMostrar = contactos) {
                listaContactos.innerHTML = '';
                contactosAMostrar.forEach((contacto, index) => {
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';

                    const contenidoContacto = document.createElement('div');
                    contenidoContacto.innerHTML = `
                        ${contacto.nombre} ${contacto.apellido} - ${contacto.telefono}
                        ${contacto.favorito ? '<span class="favorite-star">⭐</span>' : ''}
                    `;

                    const acciones = document.createElement('div');

                    // Checkbox para selección múltiple
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.className = 'form-check-input me-2';
                    checkbox.setAttribute('data-index', index);
                    acciones.appendChild(checkbox);

                    // Botón de favorito
                    const botonFavorito = document.createElement('button');
                    botonFavorito.className = 'btn btn-sm btn-outline-warning me-2';
                    botonFavorito.textContent = contacto.favorito ? 'Quitar Favorito' : 'Marcar Favorito';
                    botonFavorito.onclick = () => {
                        contacto.favorito = !contacto.favorito;
                        guardarContactos();
                        mostrarListado();
                    };
                    acciones.appendChild(botonFavorito);

                    // Botón de editar
                    const botonEditar = document.createElement('button');
                    botonEditar.className = 'btn btn-sm btn-outline-info me-2';
                    botonEditar.textContent = 'Editar';
                    botonEditar.onclick = () => {
                        const nuevoNombre = prompt('Editar nombre:', contacto.nombre);
                        const nuevoApellido = prompt('Editar apellido:', contacto.apellido);
                        const nuevoTelefono = prompt('Editar teléfono:', contacto.telefono);
                        if (nuevoNombre !== null && nuevoApellido !== null && nuevoTelefono !== null) {
                            contactos[index] = {
                                nombre: nuevoNombre.trim(),
                                apellido: nuevoApellido.trim(),
                                telefono: nuevoTelefono.trim(),
                                favorito: contacto.favorito,
                            };
                            guardarContactos();
                            mostrarListado();
                        }
                    };
                    acciones.appendChild(botonEditar);

                    // Botón de eliminar
                    const botonEliminar = document.createElement('button');
                    botonEliminar.className = 'btn btn-sm btn-outline-danger';
                    botonEliminar.textContent = 'Eliminar';
                    botonEliminar.onclick = () => {
                        contactos.splice(index, 1);
                        guardarContactos();
                        mostrarListado();
                    };
                    acciones.appendChild(botonEliminar);

                    li.appendChild(contenidoContacto);
                    li.appendChild(acciones);
                    listaContactos.appendChild(li);
                });
            }

            function handlerFormulario(e) {
                e.preventDefault();
                const nombre = inputNombre.value;
                const apellido = inputApellido.value;
                const telefono = inputTelefono.value;

                if (nombre && apellido && telefono) {
                    contactos.push({
                        nombre: nombre.trim(),
                        apellido: apellido.trim(),
                        telefono: telefono.trim(),
                        favorito: false,
                    });
                    guardarContactos();
                    mostrarListado();
                    inputNombre.value = "";
                    inputApellido.value = "";
                    inputTelefono.value = "";
                }
            }

            // Manejadores de eventos
            formContacto.addEventListener('submit', handlerFormulario);
            
            buscador.addEventListener('input', (e) => {
                const textoBusqueda = e.target.value.toLowerCase();
                const contactosFiltrados = contactos.filter(contacto =>
                    contacto.nombre.toLowerCase().includes(textoBusqueda) ||
                    contacto.apellido.toLowerCase().includes(textoBusqueda) ||
                    contacto.telefono.includes(textoBusqueda)
                );
                mostrarListado(contactosFiltrados);
            });

            document.getElementById('ordenar-nombre').addEventListener('click', () => {
                contactos.sort((a, b) => a.nombre.localeCompare(b.nombre));
                mostrarListado();
                guardarContactos();
            });

            document.getElementById('ordenar-apellido').addEventListener('click', () => {
                contactos.sort((a, b) => a.apellido.localeCompare(b.apellido));
                mostrarListado();
                guardarContactos();
            });

            document.getElementById('mostrar-todos').addEventListener('click', () => {
                mostrarListado();
            });

            document.getElementById('mostrar-favoritos').addEventListener('click', () => {
                const favoritos = contactos.filter(contacto => contacto.favorito);
                mostrarListado(favoritos);
            });

            document.getElementById('eliminar-seleccionados').addEventListener('click', () => {
                const checkboxes = document.querySelectorAll('#lista-contactos input[type="checkbox"]:checked');
                const indicesAEliminar = Array.from(checkboxes).map(cb => parseInt(cb.getAttribute('data-index'))).reverse();
                
                indicesAEliminar.forEach(index => {
                    contactos.splice(index, 1);
                });

                guardarContactos();
                mostrarListado();
            });
            
            // Cargar y mostrar la lista inicial
            mostrarListado();
        });
    </script>
</body>
</html>
